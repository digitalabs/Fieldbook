<form id="createNurseryForm" role="form-horizontal" action="#" th:action="@{/NurseryManager/createNursery}" method="post" th:object="${createNurseryForm}" enctype="multipart/form-data">
<input type="hidden" th:field="*{requiredFields}"/>
<input type="hidden" th:field="*{loadSettings}"/>
<input type="hidden" th:field="*{locationId}"/>
<input type="hidden" th:field="*{breedingMethodId}"/>
<input type="hidden" th:field="*{breedingMethodUrl}"/>
<input type="hidden" th:field="*{importLocationUrl}"/>
<input type="hidden" th:field="*{studyNameTermId}"/>
<input type="hidden" th:field="*{startDateId}"/>
<input type="hidden" th:field="*{endDateId}"/>
<input type="hidden" th:field="*{openGermplasmUrl}"/>
<input type="hidden" th:field="*{idNameVariables}"/>
<input type="hidden" th:field="*{breedingMethodCode}"/>
<input type="hidden" th:field="*{errorMessage}" />
<input type="hidden" th:field="*{hasError}" />

<div class="row">
	<div class="col-xs-6">

		<div class="form-group chs-management-details">
			<label class="control-label" data-toggle="collapse" data-target=".nurseryLevelDetails">
                <span class="bms-mgt-details fbk-trial-summary-icons"></span>
                <strong class="sub-content-heading" th:text="#{nursery.managesettings.management.details}">MANAGEMENT DETAILS</strong>
				<span class="bms-fa-question-circle help-tooltip-nursery" data-placement="right" data-toggle="tooltip" data-container="body" th:title="#{nursery.managesettings.nursery.level.notes}"></span>

			</label>

			<a href="#" class="btn btn-info pull-right chs-add-variable" th:text="#{nursery.create.nursery.add.settings}">Add</a>

        </div>
        <div class="form-group management-details-section-reminder fbk-hide">
        	<label class="control-label" th:text="#{section.reminder.to.add.records}"></label>
        </div>
        <div class="form-horizontal sectionContainer" id="nurseryLevelSettings-dev">

			<div class="form-group nurseryLevelSettings" th:each="nurseryLevelVariable, rowStat : *{studyLevelVariables}" th:if="${nurseryLevelVariable.variable.cvTermId}!=*{breedingMethodId} and ${nurseryLevelVariable.variable.cvTermId}!=*{breedingMethodCode}">
				<div class="col-xs-5 1st">						
					<input class="remove-indv-btn" type="checkbox" th:if="${nurseryLevelVariable.deletable}" th:attr="data-variable-type=1" th:attrappend="data-cv-term-id=${nurseryLevelVariable.variable.cvTermId}"/>       
                    <input class="cvTermIds nurseryLevelVariableIdClass" type="hidden" th:field="*{studyLevelVariables[__${rowStat.index}__].variable.cvTermId}" />
                    &nbsp;&nbsp;&nbsp;                                        
                    <a href="javascript: void(0);" th:onclick="'javascript:showBaselineTraitDetailsModal(\'' +
									*{studyLevelVariables[__${rowStat.index}__].variable.cvTermId} + '\');'" >
							<span style="word-wrap: break-word" class="control-label nursery-level-label label-bold var-names" th:text="${nurseryLevelVariable.variable.name}"></span></a>:&nbsp;
							
                </div>
                <div class="col-xs-7 2nd">

                    <input style="width: 30%" th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}"
                           type="hidden" th:field="*{studyLevelVariables[__${rowStat.index}__].value}" class="form-control select2" />

					<input th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" class="selectedValue" type="hidden" th:value="*{studyLevelVariables[__${rowStat.index}__].value}" />
					<input th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" class="selectedValueFave" type="hidden" th:value="*{studyLevelVariables[__${rowStat.index}__].value}" />

					<!-- Show Favorite Location -->
					<div style="width: 100%" th:if="${nurseryLevelVariable.variable.cvTermId}==*{locationId}" class="possibleValuesDiv">
						<input
								type="checkbox" th:field="*{studyLevelVariables[__${rowStat.index}__].favorite}"
								th:onclick="'javascript: toggleLocationDropdown(\'' + ${rowStat.index} + '\');'" />
						&nbsp;&nbsp;
											<span
													th:text="#{show.favorite.location}">Show Favorite Location</span>
					</div>

					<!-- store possible values of variable -->
					<div th:text="${nurseryLevelVariable.value}" class="div-select-val" style="display: none"></div>
					<div th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" th:id="'possibleValuesJson' + ${rowStat.index}"
						 class="possibleValuesJson" style="display:none" th:text="${nurseryLevelVariable.possibleValuesJson}">
					</div>
					<div th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" th:id="'possibleValuesFavoriteJson' + ${rowStat.index}"
						 class="possibleValuesFavoriteJson" style="display:none" th:text="${nurseryLevelVariable.possibleValuesFavoriteJson}">
					</div>

					<input  maxlength="250"  th:if="${nurseryLevelVariable.variable.widgetType.type == 'NTEXT'}"
						   type="text" th:field="*{studyLevelVariables[__${rowStat.index}__].value}" class="form-control numeric-input" />

					<input  maxlength="250"  th:if="${nurseryLevelVariable.variable.widgetType.type == 'CTEXT'}"
						   type="text" th:field="*{studyLevelVariables[__${rowStat.index}__].value}" class="form-control character-input" />

					<textarea  maxlength="250"  th:if="${nurseryLevelVariable.variable.widgetType.type == 'TEXTAREA'}"
							  th:field="*{studyLevelVariables[__${rowStat.index}__].value}" class="form-control character-input" rows="3" />

					<input th:if="${nurseryLevelVariable.variable.widgetType.type == 'DATE'}"
						   type="text" placeholder="yyyy-mm-dd" th:field="*{studyLevelVariables[__${rowStat.index}__].value}" class="form-control date-input" />
					<label  th:if="${nurseryLevelVariable.variable.widgetType.type == 'DATE'}"  class="btn datepicker">
						<img th:src="@{/static/img/calendar.png}" style="padding-bottom:3px;" />
					</label>

					<input  maxlength="250"  th:if="${nurseryLevelVariable.variable.widgetType.type == 'SLIDER'}"
						   type="text" th:field="*{studyLevelVariables[__${rowStat.index}__].value}"
						   th:attr="data-min=${nurseryLevelVariable.variable.minRange}"
						   th:attrappend="data-max=${nurseryLevelVariable.variable.maxRange}"
						   class="form-control numeric-input"
							/>

								<span>
									<a th:if="${nurseryLevelVariable.variable.cvTermId}==*{locationId}" href="javascript: openManageLocations();" th:text="#{nursery.managesettings.manage.location}">Manage Location</a>
								</span>
				</div>							
			</div>
			<div class="row col-xs-12 remove-all-section">
			  <div class="col-xs-12">
			    <input class="remove-btn" type="checkbox" data-section="nurseryLevelSettings"/>&nbsp;&nbsp;&nbsp;<label>Select All</label>&nbsp;&nbsp;&nbsp;
			    <a href="javascript: void(0);" class="remove-all-vars" data-variable-type="1" data-section="nurseryLevelSettings">Remove</a>
			  </div>
			</div>
		</div>

		<div class="form-group chs-factors">
			<img width="23" height="23" th:src="@{/static/img/factors.png}" class="image-padding" /> &nbsp;
			<label class="control-label" data-toggle="collapse" data-target=".plotLevelDetails">
				<strong class="sub-content-heading" th:text="#{nursery.managesettings.plot.level.details}">PLOT-LEVEL DETAILS</strong>
				<span class="bms-fa-question-circle help-tooltip-nursery" data-placement="right" data-toggle="tooltip" data-container="body" th:title="#{nursery.managesettings.plot.level.notes}"></span>
			</label>
			<a href="#" class="btn btn-info pull-right chs-add-variable chs-add-variable-factor fbk-hide" th:text="#{nursery.create.nursery.add.settings}">Add</a>
		</div>
		<div class="form-group collapse in plotLevelDetails">
			<table style="table-layout: fixed;" class="my-class table table-curved table-condensed" id="plotLevelSettings">
				<thead>
				<tr>
					<th class="fbk-delete-link"></th>
					<th width="45%" th:utext="#{nursery.managesettings.plot.name}">.Name</th>
					<th width="50%" th:utext="#{nursery.managesettings.plot.description}">.Description</th>
				</tr>
				</thead>
				<tbody>
				<tr th:each="plotLevelVariable, rowStat : *{plotLevelVariables}">
					<td style="text-align: center" th:class="${rowStat.even}? 'even fbk-delete-link' : 'odd fbk-delete-link'">						
						<input class="remove-indv-btn" type="checkbox" th:if="${plotLevelVariable.deletable}" th:attr="data-variable-type=2" th:attrappend="data-cv-term-id=${plotLevelVariable.variable.cvTermId}"/>
						<input class="cvTermIds" type="hidden" th:field="*{plotLevelVariables[__${rowStat.index}__].variable.cvTermId}" />
					</td>
					<td width="45%" th:class="${rowStat.even}? 'even' : 'odd'">
						<a href="javascript: void(0);" th:onclick="'javascript:showBaselineTraitDetailsModal(\'' +
									*{plotLevelVariables[__${rowStat.index}__].variable.cvTermId} + '\');'" >
							<span class="var-names" th:text="${plotLevelVariable.variable.name}"></span></a>
					</td>
					<td width="50%" th:class="${rowStat.even}? 'even' : 'odd'" th:text="${plotLevelVariable.variable.description}"></td>
				</tr>
				</tbody>
			</table>
			
			<div class="row col-xs-12 remove-all-section">
			  <div class="col-xs-12">
			    <input class="remove-btn" type="checkbox" data-section="plotLevelDetails"/>&nbsp;&nbsp;&nbsp;<label>Select All</label>&nbsp;&nbsp;&nbsp;
			    <a href="javascript: void(0);" class="remove-all-vars" data-variable-type="2" data-section="plotLevelDetails">Remove</a>
			  </div>
			</div>
		</div>

		
		<!-- selection variates -->
		<div class="form-group chs-selection-variates">
			<span class="fbk-font-icon bms-variates"></span>
            <label class="control-label" data-toggle="collapse" data-target=".selectionVariatesDetails">
				<strong class="sub-content-heading" th:text="#{nursery.create.nursery.selection.variates}">SELECTION VARIATES</strong>
				<span class="bms-fa-question-circle help-tooltip-nursery" data-placement="right" data-toggle="tooltip" data-container="body" th:title="#{nursery.create.nursery.selection.variates.notes}"></span>
			</label>

			<a class="btn btn-info pull-right chs-add-variable" href="#" th:text="#{nursery.create.nursery.add.settings}">Add</a>
		</div>
		<div class="form-group collapse in selectionVariatesDetails">
			<table style="table-layout: fixed;" class="my-class table table-curved table-condensed selection-variate-table" id="selectionVariatesSettings">
				<thead>
				<tr>
					<th class="fbk-delete-link"></th>
					<th width="45%" th:utext="#{nursery.create.nursery.selection.variate.name}">.Name</th>
					<th width="50%" th:utext="#{nursery.create.nursery.selection.variate.description}">.Description</th>
				</tr>
				</thead>
				<tbody>
                <tr class="dummy-row" th:if="${#lists.isEmpty(selectionVariatesVariables)}">
                	<td class="even dummy-col">&nbsp;</td>
                	<td class="even">&nbsp;</td>
                	<td class="even">&nbsp;</td>
                </tr>
				<tr th:each="selectionVariatesVariable, rowStat : *{selectionVariatesVariables}">
					<td style="text-align: center" th:class="${rowStat.even}? 'even fbk-delete-link' : 'odd fbk-delete-link'">
						<input class="remove-indv-btn" type="checkbox" th:if="${selectionVariatesVariable.deletable}" th:attr="data-variable-type=6" th:attrappend="data-cv-term-id=${selectionVariatesVariable.variable.cvTermId}"/>
						<input class="cvTermIds" type="hidden" th:field="*{selectionVariatesVariables[__${rowStat.index}__].variable.cvTermId}" />
					</td>
					<td width="45%" th:class="${rowStat.even}? 'even' : 'odd'">
						<a href="javascript: void(0);" th:onclick="'javascript:showBaselineTraitDetailsModal(\'' +
									*{selectionVariatesVariables[__${rowStat.index}__].variable.cvTermId} + '\');'" >
							<span class="var-names" th:text="${selectionVariatesVariable.variable.name}"></span></a>
					</td>
					<td width="50%" th:class="${rowStat.even}? 'even' : 'odd'" th:text="${selectionVariatesVariable.variable.description}"></td>
				</tr>
				</tbody>
			</table>
			
			<div class="row col-xs-12 remove-all-section">
			  <div class="col-xs-12">
			    <input class="remove-btn" type="checkbox" data-section="selectionVariatesDetails"/>&nbsp;&nbsp;&nbsp;<label>Select All</label>&nbsp;&nbsp;&nbsp;
				<a href="javascript: void(0);" class="remove-all-vars" data-variable-type="6" data-section="selectionVariatesDetails">Remove</a>
			  </div>
			</div>
		</div>

		<div class=" row collapse in" th:each="nurseryLevelVariable, rowStat : *{studyLevelVariables}" th:if="${nurseryLevelVariable.variable.cvTermId}==*{breedingMethodId} or ${nurseryLevelVariable.variable.cvTermId}==*{breedingMethodCode}" th:remove="tag">
			<div class="form-group">
				<span th:text="#{nursery.create.nursery.method.note}">If you plan to advance the nursery with a single method, please select it below</span>
			</div>

			<div class="row form-group clearfix breedingMethodDetails">
				<div class="col-xs-8 1st">
					<input class="cvTermIds" type="hidden" th:field="*{studyLevelVariables[__${rowStat.index}__].variable.cvTermId}" />
					<input style="width: 70%" th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}"
						   type="hidden" th:field="*{studyLevelVariables[__${rowStat.index}__].value}" class="select2 form-control study-level-method" />

					<input th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" class="selectedValue" type="hidden" th:value="*{studyLevelVariables[__${rowStat.index}__].value}" />
					<input th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" class="selectedValueFave" type="hidden" th:value="*{studyLevelVariables[__${rowStat.index}__].value}" />
					<!-- store possible values of variable -->
					<div th:text="${nurseryLevelVariable.value}" class="div-select-val" style="display: none"></div>
					<div th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" th:id="'possibleValuesJson' + ${rowStat.index}"
						 class="possibleValuesJson" style="display:none" th:text="${nurseryLevelVariable.possibleValuesJson}">
					</div>
					<div th:if="${nurseryLevelVariable.variable.widgetType.type == 'DROPDOWN'}" th:id="'possibleValuesFavoriteJson' + ${rowStat.index}"
						 class="possibleValuesFavoriteJson" style="display:none" th:text="${nurseryLevelVariable.possibleValuesFavoriteJson}">
					</div>
				</div>
				<div class="col-xs-4 breeding-method-note">
					<span class="bms-fa-question-circle help-tooltip-nursery breeding-method-tooltip" data-placement="right" data-toggle="tooltip" data-container="body"></span>
				</div>
			</div>

			<div class="form-group possibleValuesDiv " th:if="${nurseryLevelVariable.variable.cvTermId}==*{breedingMethodId} or ${nurseryLevelVariable.variable.cvTermId}==*{breedingMethodCode}">
				<input class="study-level-method-checkbox"
						type="checkbox" th:field="*{studyLevelVariables[__${rowStat.index}__].favorite}"
						th:onclick="'javascript: toggleMethodDropdown(\'' + ${rowStat.index} + '\');'" />
				&nbsp;&nbsp;
				<span th:text="#{show.favorite.method}">Show Favorite Method</span>&nbsp;&nbsp;
				<a th:if="${nurseryLevelVariable.variable.cvTermId}==*{breedingMethodId} or ${nurseryLevelVariable.variable.cvTermId}==*{breedingMethodCode}" href="javascript: openManageMethods();" th:text="#{nursery.managesettings.manage.method}">Manage Method</a>
			</div>
		</div>
	</div>
	<div class="col-xs-6">

		<div class="form-group chs-nursery-conditions">
			<label class="control-label" data-toggle="collapse" data-target=".nurseryConditionsDetails">
                <img th:src="@{/static/svg/conditions.svg}" style="margin: 0px 4px;" width="22" height="22" />
                <strong class="sub-content-heading" th:text="#{nursery.create.nursery.conditions}">NURSERY CONDITIONS</strong>
				<span class="bms-fa-question-circle help-tooltip-nursery" data-placement="right" data-toggle="tooltip" data-container="body" th:title="#{nursery.create.nursery.conditions.notes}"></span>
			</label>

			<a class="btn btn-info pull-right chs-add-variable" href="#" th:text="#{nursery.create.nursery.add.settings}">Add</a>
        </div>
         <div class="form-group constants-section-reminder fbk-hide">
        	<label class="control-label" th:text="#{section.reminder.to.add.records}"></label>
		</div>
		<div class="form-horizontal sectionContainer collapse in nurseryConditionsDetails" id="nurseryConditionsSettings">
			<div class="form-group nurseryConditionsSettings" th:each="nurseryCondition, rowStat : *{nurseryConditions}">
				<div class="col-xs-5 col-md-5 1st">
					<input class="remove-indv-btn" type="checkbox" th:if="${nurseryCondition.deletable}" th:attr="data-variable-type=7" th:attrappend="data-cv-term-id=${nurseryCondition.variable.cvTermId}"/>									  
					<input class="cvTermIds nurseryConditionVariableIdClass" type="hidden" th:field="*{nurseryConditions[__${rowStat.index}__].variable.cvTermId}" />&nbsp;&nbsp;&nbsp;
					
					
					<a href="javascript: void(0);" th:onclick="'javascript:showBaselineTraitDetailsModal(\'' +
									*{nurseryConditions[__${rowStat.index}__].variable.cvTermId} + '\');'" >
									<span style="word-wrap: break-word" class="control-label nursery-condition-label label-bold var-names" th:text="${nurseryCondition.variable.name}"></span></a>:&nbsp;
									
				</div>
				<div class="col-xs-7 col-md-7 2nd">
					<input style="width: 30%" th:if="${nurseryCondition.variable.widgetType.type == 'DROPDOWN'}"
						   type="hidden" th:field="*{nurseryConditions[__${rowStat.index}__].value}" class="form-control select2" />

					<!-- store possible values of variable -->
					<div th:text="${nurseryCondition.value}" class="div-select-val" style="display: none"></div>
					<div th:if="${nurseryCondition.variable.widgetType.type == 'DROPDOWN'}" th:id="'possibleValuesJsonCons' + ${rowStat.index}"
						 class="possibleValuesJsonCons" style="display:none" th:text="${nurseryCondition.possibleValuesJson}">
					</div>
					<div th:if="${nurseryCondition.variable.widgetType.type == 'DROPDOWN'}" th:id="'possibleValuesFavoriteJsonCons' + ${rowStat.index}"
						 class="possibleValuesFavoriteJsonCons" style="display:none" th:text="${nurseryCondition.possibleValuesFavoriteJson}">
					</div>

					<input  maxlength="250" th:if="${nurseryCondition.variable.widgetType.type == 'NTEXT'}"
						   type="text" th:field="*{nurseryConditions[__${rowStat.index}__].value}" class="form-control numeric-input" />

					<input  maxlength="250" th:if="${nurseryCondition.variable.widgetType.type == 'CTEXT'}"
						   type="text" th:field="*{nurseryConditions[__${rowStat.index}__].value}" class="form-control character-input" />

					<textarea  maxlength="250" th:if="${nurseryCondition.variable.widgetType.type == 'TEXTAREA'}"
							  th:field="*{nurseryConditions[__${rowStat.index}__].value}" class="form-control character-input" rows="3" />

					<input th:if="${nurseryCondition.variable.widgetType.type == 'DATE'}"
						   type="text" th:field="*{nurseryConditions[__${rowStat.index}__].value}" class="form-control date-input" />
					<label  th:if="${nurseryCondition.variable.widgetType.type == 'DATE'}"  class="btn datepicker">
						<img th:src="@{/static/img/calendar.png}" style="padding-bottom:3px;" />
					</label>

					<input  maxlength="250" th:if="${nurseryCondition.variable.widgetType.type == 'SLIDER'}"
						   type="text" th:field="*{nurseryConditions[__${rowStat.index}__].value}"
						   th:attr="data-min=${nurseryCondition.variable.minRange}"
						   th:attrappend="data-max=${nurseryCondition.variable.maxRange}"
						   class="form-control numeric-input"
							/>
				</div>
			</div>
			
			<div class="row col-xs-12 remove-all-section">
			  <div class="col-xs-12">
			    <input class="remove-btn" type="checkbox" data-section="nurseryConditionsDetails"/>&nbsp;&nbsp;&nbsp;<label>Select All</label>&nbsp;&nbsp;&nbsp;
			    <a href="javascript: void(0);" class="remove-all-vars" data-variable-type="7" data-section="nurseryConditionsDetails">Remove</a>
			  </div>
			</div>
		</div>

		<div class="form-group chs-traits">
			<img width="23" height="23" th:src="@{/static/img/baseline-traits.png}" class="image-padding" /> &nbsp;
			<label class="control-label" data-toggle="collapse" data-target=".baselineTraitDetails">
				<strong class="sub-content-heading" th:text="#{nursery.managesettings.baseline.traits}">BASELINE TRAITS</strong>
				<span class="bms-fa-question-circle help-tooltip-nursery" data-placement="right" data-toggle="tooltip" data-container="body" th:title="#{nursery.managesettings.baseline.traits.notes}"></span>
			</label>

			<a class="btn btn-info pull-right chs-add-variable" href="#" th:text="#{nursery.create.nursery.add.settings}">Add</a>
		</div>
		<div class="form-group collapse in baselineTraitDetails">
			<table style="table-layout: fixed;" class="my-class table table-curved table-condensed traits-table" id="baselineTraitSettings">
				<thead>
				<tr>
					<th class="fbk-delete-link"></th>
					<th width="45%" th:utext="#{nursery.managesettings.trait}">.Trait</th>
					<th width="50%" th:utext="#{nursery.managesettings.trait.description}">.Description</th>
				</tr>
				</thead>
				<tbody>
                <tr class="dummy-row">
                	<td class="even dummy-col">&nbsp;</td>
                	<td class="even">&nbsp;</td>
                	<td class="even">&nbsp;</td>
                </tr>
				<tr class="baseline-traits" th:each="baselineTraitVariable, rowStat : *{baselineTraitVariables}">
					<td style="text-align: center" th:class="${rowStat.even}? 'even fbk-delete-link' : 'odd fbk-delete-link'" >
						<input class="remove-indv-btn" type="checkbox" th:if="${baselineTraitVariable.deletable}" th:attr="data-variable-type=3" th:attrappend="data-cv-term-id=${baselineTraitVariable.variable.cvTermId}"/>
						<input class="cvTermIds" type="hidden" th:field="*{baselineTraitVariables[__${rowStat.index}__].variable.cvTermId}" />
					</td>
					<td width="45%" th:class="${rowStat.even}? 'even' : 'odd'">
						<a href="javascript: void(0);" th:onclick="'javascript:showBaselineTraitDetailsModal(\'' +
									*{baselineTraitVariables[__${rowStat.index}__].variable.cvTermId} + '\');'" >
							<span class="var-names" th:text="${baselineTraitVariable.variable.name}"></span></a>
					</td>
					<td width="50%" th:class="${rowStat.even}? 'even' : 'odd'" th:text="${baselineTraitVariable.variable.description}"></td>
				</tr>
				</tbody>
			</table>
			<div class="row col-xs-12 remove-all-section">
			  <div class="col-xs-12">
			    <input class="remove-btn" type="checkbox" data-section="baselineTraitDetails"/>&nbsp;&nbsp;&nbsp;<label>Select All</label>&nbsp;&nbsp;&nbsp;
			    <a href="javascript: void(0);" class="remove-all-vars" data-variable-type="3" data-section="baselineTraitDetails">Remove</a>
			  </div>
			</div>
		</div>
	</div>
</div>

<div th:include="/NurseryManager/includes/variableSelectionModal"></div>

</form>
<div class="row">
	<div class="col-xs-12 col-md-12">
		<div id="showBaselineTraitDetails" th:include="/NurseryManager/includes/baselineTraitDetails"></div>
	</div>
</div>
<div layout:fragment="page-script">
<script type="text/javascript" th:src="@{/static/js/lib/handlebars.js}"></script>
<script type="text/javascript" th:src="@{/static/js/nurseryManager.js}"></script>
<script type="text/javascript" th:src="@{/static/js/nursery-manager/choose-settings.js}"></script>
<script type="text/javascript" th:src="@{/static/js/nursery-manager/property-select.js}"></script>
<script type="text/javascript" th:src="@{/static/js/nursery-manager/variable-selection.js}"></script>
<link th:href="@{/static/css/lib/bootstrap/bootstrap-datepicker.css}" rel="stylesheet"/>
<script type="text/javascript" th:src="@{/static/js/lib/bootstrap/bootstrap-datepicker.js}"></script>
<script type="text/javascript" th:src="@{/static/js/lib/bootstrap/bootstrap-spinedit.js}"></script>
<link th:href="@{/static/css/lib/bootstrap/bootstrap-spinedit.css}" rel="stylesheet"/>
<link th:href="@{/static/css/fieldbook-spinner.css}" rel="stylesheet"/>
<script type='text/javascript' th:inline="javascript">
//<![CDATA[

// FIXME Should not be using global variables or functions
/*global getIEVersion, getJquerySafeId, initializePossibleValuesCombo, setTimeout*/
/*global addCreateNurseryRequiredAsterisk, doOntologyTreeHighlight */
/*global checkTraitsAndSelectionVariateTable*/

/* jshint ignore:start */
var nurseryFieldsIsRequired = /*[[#{nursery.create.is.required}]]*/ '',
	nurseryGermplasmListIsRequired = /*[[#{nursery.create.germplasm.list.is.required}]]*/ '',
	checkTypeIsRequired = /*[[#{nursery.create.check.type.is.required}]]*/ '',

	// Labels for method and location
	showFavoriteMethodLabel = /*[[#{show.favorite.method}]]*/ '',
	showFavoriteLocationLabel = /*[[#{show.favorite.location}]]*/ '',
	manageMethodLabel = /*[[#{nursery.managesettings.manage.method}]]*/ '',
	manageLocationLabel = /*[[#{nursery.managesettings.manage.location}]]*/ '',

	varInListMessage = /*[[#{nursery.managesettings.variable.in.selected.list}]]*/ '',
	idNameCounterpartAddedError = /*[[#{manage.settings.id.name.counterpart.added.error}]]*/ '',
	valueNotNumeric = /*[[#{nursery.create.nursery.value.not.numeric}]]*/ '',
	valueNotWIMinMax = /*[[#{nursery.create.nursery.value.not.within.min.max}]]*/ '',

	locationIframeOpened = false,
	methodIframeOpened = false,

	selectionVariatesSegment = 6,
	baselineTraitsSegment = 3;
/* jshint ignore:end */

var locationId = '',
	breedingMethodId = '',
	importLocationUrl = '',
	requiredFields = [],
	startDateId = '',
	endDateId = '',

	disabledActionTooltipMessage = /*[[#{nursery.create.actions.is.disabled}]]*/ '',

	treeDivId = 'ontologyBrowserTree',

	ChooseSettings = window.ChooseSettings,

	chooseSettings;

$(document).ready(function() {
	'use strict';

	chooseSettings = new ChooseSettings({
		generalAjaxError: /*[[#{nursery.managesettings.variable.selection.error}]]*/ '',
		uniqueVariableError: /*[[#{variable.selection.unique.variable.error}]]*/ '',
		mdLabel: /*[[#{nursery.managesettings.add.nursery.level.settings}]]*/ '',
		mdPlaceholder: /*[[#{nursery.reminder.add.nursery.settings}]]*/ '',
		fdLabel: /*[[#{nursery.managesettings.add.plot.level.settings}]]*/ '',
		fdPlaceholder: /*[[#{nursery.reminder.add.plot.settings}]]*/ '',
		svLabel: /*[[#{nursery.managesettings.add.selection.variates}]]*/ '',
		svPlaceholder: /*[[#{nursery.reminder.add.selection.variates}]]*/ '',
		tdLabel: /*[[#{nursery.managesettings.add.baseline.traits}]]*/ '',
		tdPlaceholder: /*[[#{nursery.reminder.add.trait.settings}]]*/ '',
		ncLabel: /*[[#{nursery.managesettings.add.nursery.conditions}]]*/ '',
		ncPlaceholder: /*[[#{nursery.reminder.add.nursery.conditions}]]*/ '',
		variableSelectedMessage: /*[[#{common.warning.variable.in.use}]]*/ '',
		invalidAliasError: /*[[#{variable.selection.alias.error}]]*/ ''
	});

	chooseSettings.initialiseVariableSelection();

	// FIXME Shouldn't be user agent checking
	if (getIEVersion() === 8) {
		$('.table-with-scroll-create').parent().addClass('variable-details');
		$('.table-with-scroll-create').removeClass('table-with-scroll-create');
	}
	if ($('#requiredFields').val() !== '') {
		requiredFields = $('#requiredFields').val().split(',');
	}

	startDateId = $('#startDateId').val();
	endDateId = $('#endDateId').val();
	locationId = $('#locationId').val();
	breedingMethodId = $('#breedingMethodId').val();
	importLocationUrl = $('#importLocationUrl').val();

	$('#folderNameSpan').html($('#folderName').val());

    var possibleValuesJsonElm = $('.possibleValuesJson');

    $.each(possibleValuesJsonElm, function(index, divElem) {
		var select2Index = $(divElem).attr('id').split('possibleValuesJson')[1];

		if (parseInt($('#' + getJquerySafeId('studyLevelVariables' + select2Index +
				'.variable.cvTermId')).val(), 10) === parseInt(locationId, 10)) {

			initializePossibleValuesCombo($.parseJSON(divElem.innerHTML),
							'#' + getJquerySafeId('studyLevelVariables' + select2Index +
							'.value'), true, $(divElem).siblings('.div-select-val').html());
		} else {
			initializePossibleValuesCombo($.parseJSON(divElem.innerHTML),
							'#' + getJquerySafeId('studyLevelVariables' + select2Index +
							'.value'), false, $(divElem).siblings('.div-select-val').html());
		}
	});

	$.each($('.possibleValuesJsonCons'), function(index, divElem) {
		var select2Index = $(divElem).attr('id').split('possibleValuesJsonCons')[1];
		initializePossibleValuesCombo($.parseJSON(divElem.innerHTML),
						'#' + getJquerySafeId('nurseryConditions' + select2Index +
						'.value'), false, $(divElem).siblings('.div-select-val').html());
	});

	// FIXME - Shouldn't pass a string here
	setTimeout('initializeDateAndSliderInputs()', 500);

	addCreateNurseryRequiredAsterisk();

	$('#srch-term').on('change', function() {
		var data = $('#srch-term').select2('data');
		doOntologyTreeHighlight(treeDivId, data.key);
	});

    $('.vs-modal').on('variable-select',function(event){
        if (document.disableActions !== undefined) {
            document.disableActions();
        }
    });


    // remove any other listeners for the location update
    $(document).off('location-update');
    $(document).on('location-update', recreateLocationCombo);

	$('#variateDeleteConfirmationModal').on('click', '#cancelDelete', function() {
		if (document.initialEnabledStat && document.enableActions !== undefined) {
			document.enableActions();
		}
	});

	$('#variateDeleteConfirmationModal').on('click', '#continueDelete', function() {
		if (document.disableActions !== undefined) {
			document.disableActions();
		}
	});


	document.disableActions = function() {
		var actionBtn = $('.fbk-action-btn');

		actionBtn.removeAttr('data-toggle').addClass('disabled enable-pointer-events');
		actionBtn.tooltip({container: 'body', title: disabledActionTooltipMessage, placement: 'top'});

	};

	document.enableActions = function() {
		var actionBtn = $('.fbk-action-btn');

		actionBtn.attr('data-toggle', 'dropdown');
		actionBtn.tooltip('hide');
		actionBtn.tooltip('destroy');
		actionBtn.removeClass('disabled');
	};


    if ($('#baselineTraitSettings tbody tr').length > 1) {
        hideDummyRow('baselineTraitSettings');
    }

    if ($('#selectionVariatesSettings tbody tr').length > 1) {
        hideDummyRow('selectionVariatesSettings');
    }
    checkShowSettingsFormReminder();

    // toggle favorites by default on edit if value is a favorite
    if ($('.edit-nursery-page-identifier').length) {
        $.each(possibleValuesJsonElm, function(index, divElem) {
            var select2Index = $(divElem).attr('id').split('possibleValuesJson')[1];
            checkFavoritesIfValIsAFavorite(select2Index);
        });
    }
    checkNurseryIfShowRemoveVariableLinks();
    $('.remove-btn').on('click', function(){
    	var sectionDiv = $(this).data('section');
    	var isChecked = $(this).prop('checked');
    	$('.'+sectionDiv+' .remove-indv-btn').prop('checked', isChecked);    		
    });
    $('.remove-all-vars').on('click', function(){
    	var sectionDiv = $(this).data('section');
    	var variableType = $(this).data('variable-type');
    	var checkedInput = $('.'+sectionDiv+' .remove-indv-btn:checked');
    	var deleteVarIds = '';
    	if(checkedInput.length === 0) {
    		showAlertMessage('', 'Please choose variables to be deleted');
    		return false;
    	} else {
    		checkedInput.each(function(){
    			if(deleteVarIds !== '') {
    				deleteVarIds += '|';
    			}	
    			deleteVarIds += $(this).data('cv-term-id');    			
    		});
    		
    		deleteMultiVariable(variableType, deleteVarIds, sectionDiv);
    	}
    });
});
//]]>
</script>
</div>
